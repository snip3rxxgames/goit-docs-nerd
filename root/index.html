<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lunox Game Hub</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* --- Base Styles --- */
        html, body {
            height: 100%;
            margin: 0;
            overflow: hidden; /* Prevent scrolling on main page */
            background-color: #000;
            color: #fff;
            font-family: 'Inter', 'Segoe UI', 'Roboto', 'Helvetica Neue', Arial, sans-serif;
            cursor: default;
        }

        /* --- Starry Background --- */
        #star-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
        }

        /* --- Main App Wrapper --- */
        #app-wrapper {
            position: relative;
            z-index: 1;
            height: 100vh;
            width: 100vw;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            padding-top: 0; /* Will be 90px if notification is active */
            transition: padding-top 0.5s ease-in-out;
        }

        /* --- Notification Banner --- */
        #notification-banner {
            position: fixed;
            top: -100px; /* Start off-screen */
            left: 0;
            width: 100%;
            height: 90px; /* 70px bar + 20px */
            background-color: #FFA500; /* yellowish-orange */
            color: #000;
            z-index: 10000;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 1.5rem;
            transition: top 0.5s ease-in-out;
            box-shadow: 0 4px 10px rgba(0,0,0,0.4);
        }
        #notification-banner.show {
            top: 0;
        }
        #notification-fade-canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 10;
            pointer-events: none;
            display: none; /* Show on hide */
        }
        .notification-content {
            display: flex;
            align-items: center;
            gap: 1rem;
            font-weight: 600;
            z-index: 5;
        }
        #notification-button {
            background-color: #FF8C00; /* solid orange */
            color: #fff;
            font-weight: 700;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        #notification-button:hover { background-color: #FF7000; }
        #notification-close {
            background: none;
            border: none;
            cursor: pointer;
            position: absolute;
            top: 10px;
            right: 10px;
            padding: 0.5rem;
            z-index: 5;
        }
        #notification-close svg { width: 24px; height: 24px; stroke: #000; }


        /* --- Header / Nav --- */
        header {
            flex-shrink: 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 1.5rem;
            background: linear-gradient(180deg, rgba(0,0,0,0.7) 0%, rgba(0,0,0,0) 100%);
            border-bottom: 1px solid rgba(50, 50, 50, 0.5);
            height: 70px;
            position: relative; /* for counter overlay */
            z-index: 2; /* Below menu */
        }
        
        #menu-btn {
            background: none;
            border: none;
            padding: 0.5rem;
            cursor: pointer;
            z-index: 1001;
            flex-shrink: 0; /* Prevent shrinking */
        }
        #menu-btn svg {
            width: 30px;
            height: 30px;
            stroke: #fff;
            transition: all 0.2s ease;
        }
        #menu-btn:hover svg {
            stroke: #00ffff;
        }

        /* --- Snip3r Sign --- */
        #snip3r-sign {
            background-color: transparent;
            width: 150px;
            height: 30px;
            perspective: 1000px;
            cursor: pointer;
            margin: 0 1rem; /* Space it out */
            flex-shrink: 0; /* Don't let it shrink */
        }
        .flip-card-inner {
            position: relative;
            width: 100%;
            height: 100%;
            text-align: center;
            transition: transform 0.6s;
            transform-style: preserve-3d;
        }
        #snip3r-sign.is-flipped .flip-card-inner {
            transform: rotateY(180deg);
        }
        .flip-card-front, .flip-card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            -webkit-backface-visibility: hidden; /* Safari */
            backface-visibility: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 5px;
            font-weight: 600;
        }
        .flip-card-front {
            background-color: transparent;
            color: #00ffff;
            border: 1px solid #00ffff;
            box-shadow: 0 0 5px rgba(0, 255, 255, 0.5);
            font-size: 0.9rem;
        }
        .flip-card-back {
            background-color: #00ffff;
            color: #000;
            transform: rotateY(180deg);
            font-weight: 700;
            font-size: 0.9rem;
        }

        /* Visitor Counter Container */
        #visitor-counter-container {
            position: relative; /* For overlay */
            flex-grow: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            min-width: 0; /* Prevents overflow issues */
            z-index: 3;
        }
        #visitor-counter-blocker {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 10; /* Above counter, below menu */
        }
        #visitor-counter-container > script,
        #visitor-counter-container > a,
        #visitor-counter-container > img {
            display: inline-block;
            line-height: 1;
        }

        .logo-top-right {
            width: 40px;
            height: 40px;
            color: #fff;
            filter: drop-shadow(0 0 5px #00ffff);
            transition: transform 0.2s ease-in-out;
            flex-shrink: 0; /* Prevent shrinking */
            z-index: 3;
        }
        .logo-top-right:hover {
            transform: scale(1.1) rotate(15deg);
        }

        /* --- Side Menu --- */
        #menu-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 999;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }
        #menu-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        #side-menu {
            position: fixed;
            top: 0;
            left: -300px;
            width: 280px;
            height: 100vh;
            background-color: #0a0a0a;
            border-right: 1px solid #333;
            z-index: 1000;
            padding: 6rem 0 2rem 0;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            box-shadow: 5px 0 25px rgba(0, 0, 0, 0.5);
            transition: left 0.3s ease-in-out;
        }
        #side-menu.active {
            left: 0;
        }
        .menu-link {
            display: flex;
            align-items: center;
            gap: 1rem;
            font-size: 1.1rem;
            font-weight: 600;
            color: #aaa;
            padding: 1rem 1.5rem;
            text-decoration: none;
            border-bottom: 1px solid #222;
            transition: all 0.2s ease;
        }
        .menu-link:first-child {
            border-top: 1px solid #222;
        }
        .menu-link:hover {
            background-color: rgba(0, 255, 255, 0.1);
            color: #00ffff;
        }
        .menu-link svg {
            width: 24px;
            height: 24px;
        }
        #side-menu-main {
            display: flex;
            flex-direction: column;
        }
        #side-menu-footer {
            display: none;
        }

        /* --- Page Container --- */
        main {
            flex-grow: 1;
            overflow-y: auto;
            overflow-x: hidden;
            padding: 1.5rem;
        }

        .page {
            display: none;
            animation: fadeIn 0.3s ease-in-out;
        }
        .page.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* --- Games & Tools Page Grid --- */
        .card-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 1.5rem;
            justify-items: center;
        }
        @media (min-width: 640px) {
            .card-grid { grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); }
        }
        @media (min-width: 1024px) {
            .card-grid { grid-template-columns: repeat(5, 1fr); }
        }

        .card {
            width: 100%;
            aspect-ratio: 1 / 1.2;
            background-color: rgba(30, 30, 30, 0.5);
            border: 1px solid rgba(50, 50, 50, 0.7);
            border-radius: 16px;
            padding: 1rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: space-between;
            text-align: center;
            text-decoration: none;
            color: #fff;
            transition: all 0.2s ease-in-out;
            backdrop-filter: blur(5px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            cursor: pointer;
            position: relative; /* For loader */
            overflow: hidden; /* For loader */
        }
        .card:hover {
            transform: translateY(-5px);
            border-color: #00ffff;
            background-color: rgba(0, 255, 255, 0.05);
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.3);
        }
        /* Offline game card style */
        .card.offline-disabled {
            filter: grayscale(100%);
            opacity: 0.5;
            cursor: not-allowed;
            border-color: #333;
            background-color: rgba(20, 20, 20, 0.5);
        }
        .card.offline-disabled:hover {
            transform: none;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }
        /* Offline "Not Downloaded" Style */
        .card.offline-not-downloaded {
            filter: grayscale(80%);
            opacity: 0.6;
        }
        .card.offline-not-downloaded:hover {
            transform: none;
            border-color: rgba(50, 50, 50, 0.7);
            background-color: rgba(30, 30, 30, 0.5);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }
        
        .card-icon {
            width: 80%; /* Increased size */
            aspect-ratio: 1 / 1;
            border-radius: 12px;
            object-fit: cover;
            background-color: #000;
            border: 1px solid rgba(70, 70, 70, 1);
            transition: filter 0.2s ease;
        }
        /* Tool icons can be SVGs */
        .card-icon-svg {
            width: 80%; /* Increased size */
            aspect-ratio: 1 / 1;
            padding: 15%; /* Padding inside the SVG container */
            border-radius: 12px;
            object-fit: cover;
            background-color: #000;
            border: 1px solid rgba(70, 70, 70, 1);
            color: #00ffff;
        }
        .card span {
            font-weight: 600;
            font-size: 0.875rem;
            margin-top: 0.75rem;
            display: block;
            transition: filter 0.2s ease;
        }

        /* --- Card Loader --- */
        .card-loader {
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.8);
            border-radius: 16px;
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 5;
            padding: 1rem;
            box-sizing: border-box;
        }
        .card.loading .card-loader { display: flex; }
        .card.loading .card-icon, .card.loading span {
            filter: blur(2px);
        }
        .progress-bar-container {
            width: 80%;
            height: 10px;
            background-color: #333;
            border-radius: 5px;
            overflow: hidden;
            margin-bottom: 0.5rem;
        }
        .progress-bar {
            width: 0%;
            height: 100%;
            background-color: #00ffff;
            transition: width 0.1s linear;
        }
        .progress-text {
            font-size: 0.8rem;
            font-weight: 600;
            color: #00ffff;
        }


        /* --- Settings/Individual Tool Page --- */
        .setting-section {
            max-width: 900px; /* Wider for tools */
            margin: 0 auto 2rem auto;
            background-color: rgba(20, 20, 20, 0.5);
            border: 1px solid rgba(50, 50, 50, 0.7);
            border-radius: 16px;
            padding: 1.5rem;
            backdrop-filter: blur(5px);
        }
        
        /* Make Offline Games page look like Settings */
        #offline-games-page .card-grid {
            max-width: 900px;
            margin: 0 auto 2rem auto;
            background-color: rgba(20, 20, 20, 0.5);
            border: 1px solid rgba(50, 50, 50, 0.7);
            border-radius: 16px;
            padding: 1.5rem;
            backdrop-filter: blur(5px);
        }

        .setting-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: #fff;
            margin-bottom: 1rem;
            border-bottom: 1px solid rgba(50, 50, 50, 1);
            padding-bottom: 0.5rem;
        }

        .setting-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }
        .setting-item-text {
            flex-grow: 1;
        }
        .setting-item-text h3 {
            font-size: 1.1rem;
            font-weight: 600;
            color: #fff;
        }
        .setting-item-text p {
            font-size: 0.875rem;
            color: #aaa;
            margin-top: 0.25rem;
        }

        /* --- Neon Toggle Switch --- */
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 28px;
        }
        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0; left: 0; right: 0; bottom: 0;
            background-color: #333;
            border-radius: 34px;
            transition: all 0.3s ease;
            border: 1px solid #555;
        }
        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 20px;
            width: 20px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            border-radius: 50%;
            transition: all 0.3s ease;
        }
        input:checked + .toggle-slider {
            background-color: #00ffff;
            border-color: #00ffff;
            box-shadow: 0 0 10px rgba(0, 255, 255, 0.5);
        }
        input:checked + .toggle-slider:before {
            transform: translateX(22px);
        }

        /* --- Tool Styles --- */
        .tool-btn {
            display: inline-block;
            width: 100%;
            text-align: center;
            font-size: 0.875rem;
            font-weight: 600;
            color: #fff;
            background-color: rgba(0, 255, 255, 0.2);
            border: 2px solid #00ffff;
            padding: 0.75rem 1rem;
            border-radius: 8px;
            transition: all 0.2s ease;
            box-shadow: 0 0 10px rgba(0, 255, 255, 0.3);
            cursor: pointer;
            margin-bottom: 1rem;
        }
        .tool-btn:hover {
            background-color: rgba(0, 255, 255, 0.4);
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.5);
        }
        .tool-btn.secondary {
            background-color: rgba(100, 100, 100, 0.2);
            border-color: #777;
            box-shadow: none;
        }
        .tool-btn.secondary:hover {
            background-color: rgba(100, 100, 100, 0.4);
        }
        .tool-btn:disabled {
            background-color: #333;
            border-color: #555;
            color: #777;
            box-shadow: none;
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        /* Image Rounder */
        #image-preview-container {
            width: 100%;
            max-width: 400px;
            aspect-ratio: 1 / 1;
            background-color: rgba(0, 0, 0, 0.3);
            border: 2px dashed #555;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 1rem auto;
            color: #aaa;
            font-style: italic;
        }
        #image-preview {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }
        .slider-container {
            margin-top: 1.5rem;
            margin-bottom: 1.5rem;
        }
        input[type="range"] {
            width: 100%;
            -webkit-appearance: none;
            appearance: none;
            height: 8px;
            background: #333;
            border-radius: 5px;
            outline: none;
            cursor: pointer;
        }
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            background: #00ffff;
            border-radius: 50%;
            box-shadow: 0 0 5px rgba(0, 255, 255, 0.7);
            cursor: pointer;
        }
        input[type="range"]::-moz-range-thumb {
            width: 20px;
            height: 20px;
            background: #00ffff;
            border-radius: 50%;
            box-shadow: 0 0 5px rgba(0, 255, 255, 0.7);
            cursor: pointer;
        }
        .checkbox-container {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }
        
        /* Password Generator */
        #password-output-container {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
        }
        #password-output {
            flex-grow: 1;
            background-color: #000;
            border: 1px solid #444;
            padding: 1rem;
            border-radius: 8px;
            font-family: 'Courier New', Courier, monospace;
            font-size: 1.25rem;
            color: #fff;
            text-align: center;
            word-wrap: break-word;
            min-height: 60px;
        }
        #password-copy-btn {
            flex-shrink: 0;
            width: 60px;
            background-color: rgba(100, 100, 100, 0.2);
            border: 2px solid #777;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        #password-copy-btn:hover {
            background-color: rgba(100, 100, 100, 0.4);
        }
        .password-options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin: 1.5rem 0;
        }
        .password-option {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: rgba(0,0,0,0.2);
            padding: 0.75rem;
            border-radius: 8px;
        }

        /* Unit Converter */
        .converter-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 1.5rem;
        }
        .converter-group {
            background-color: rgba(0,0,0,0.2);
            padding: 1rem;
            border-radius: 8px;
        }
        .converter-group h3 {
            font-size: 1.1rem;
            font-weight: 600;
            color: #00ffff;
            margin-bottom: 1rem;
        }
        .converter-row {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 0.75rem;
        }
        .converter-input {
            width: 100%;
            background-color: #000;
            border: 1px solid #444;
            border-radius: 6px;
            padding: 0.5rem;
            color: #fff;
        }
        
        /* --- Game View Page --- */
        #game-view {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 50;
            background-color: #000;
            display: none; /* Changed: now hidden by default */
            flex-direction: column;
        }
        
        /* This rule makes it visible ONLY when active */
        #game-view.active {
            display: flex;
        }
        
        #game-iframe-wrapper {
            flex-grow: 1;
            position: relative;
        }
        #game-iframe {
            width: 100%;
            height: 100%;
            border: none;
        }
        .toast-message {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background-color: #ff3333;
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            z-index: 100;
            font-weight: 600;
        }

        #game-controls {
            flex-shrink: 0;
            height: 50px;
            background-color: #000;
            border-top: 1px solid #333;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 1rem;
        }
        .game-control-btn, .back-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            background-color: #1a1a1a;
            color: #fff;
            border: 1px solid #444;
            border-radius: 8px;
            padding: 0.5rem 1rem;
            font-weight: 600;
            transition: all 0.2s ease;
            cursor: pointer;
        }
        .game-control-btn:hover, .back-btn:hover {
            border-color: #00ffff;
            background-color: rgba(0, 255, 255, 0.1);
            color: #00ffff;
            box-shadow: 0 0 10px rgba(0, 255, 255, 0.3);
        }
        .game-control-btn svg {
            width: 20px;
            height: 20px;
        }
        .back-btn svg {
            width: 18px;
            height: 18px;
        }
        #game-title {
            font-size: 1.25rem;
            font-weight: 700;
            color: #fff;
            user-select: none;
        }

        /* --- Offline Indicator --- */
        #offline-indicator {
            position: fixed;
            top: 70px; /* Below header */
            left: 50%;
            transform: translateX(-50%) translateY(-100px); /* Start off-screen */
            background-color: #ff3333;
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            z-index: 9999;
            font-weight: 600;
            display: block;
            opacity: 0;
            transition: transform 0.3s ease-out, opacity 0.3s ease-out;
        }
        #offline-indicator.active {
            transform: translateX(-50%) translateY(0);
            opacity: 1;
        }
        /* Style for online indicator */
        #offline-indicator.online {
            background-color: #33cc33; /* Green */
        }


        /* --- Custom Context Menu --- */
        #custom-context-menu {
            position: fixed;
            z-index: 10000;
            width: 180px;
            background: #2c2b2b;
            border-radius: 10px;
            padding: 0.5rem;
            box-shadow: 0 5px 25px rgba(0, 0, 0, 0.5);
            display: none;
            border: 1px solid #444;
            backdrop-filter: blur(10px);
        }
        .context-menu-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem 1rem;
            border-radius: 6px;
            color: #fff;
            font-weight: 500;
            user-select: none;
            cursor: pointer;
        }
        .context-menu-item:hover {
            background-color: rgba(0, 255, 255, 0.1);
            color: #00ffff;
        }
        .context-menu-item svg {
            width: 18px;
            height: 18px;
        }

        /* Utility */
        .hidden { display: none; }
    </style>
</head>
<body>

    <!-- Notification Banner -->
    <div id="notification-banner">
        <canvas id="notification-fade-canvas"></canvas>
        <div class="notification-content">
            <span id="notification-text">Notification text goes here.</span>
            <button id="notification-button" class="hidden">Button</button>
        </div>
        <button id="notification-close" title="Close">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" /></svg>
        </button>
    </div>

    <!-- Starry Background -->
    <canvas id="star-canvas"></canvas>

    <!-- Side Menu -->
    <div id="menu-overlay"></div>
    <div id="side-menu">
        <div id="side-menu-main">
            <a href="#" class="menu-link" data-page="games">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M2.25 12l8.954-8.955c.44-.439 1.152-.439 1.591 0L21.75 12M4.5 9.75v10.125c0 .621.504 1.125 1.125 1.125H9.75v-4.875c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125V21h4.125c.621 0 1.125-.504 1.125-1.125V9.75M8.25 21h8.25" /></svg>
                Home
            </a>
            <a href="#" class="menu-link" data-page="offline-games">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M3 16.5v2.25A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V16.5M16.5 12L12 16.5m0 0L7.5 12m4.5 4.5V3" /></svg>
                Offline Games
            </a>
            <a href="#" class="menu-link" data-page="tools">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M11.42 15.17L17.25 21A2.652 2.652 0 0021 17.25l-5.83-5.83M11.42 15.17l-4.24-4.24m4.24 4.24l-4.24-4.24M11.42 15.17L15.17 11.42m-3.75 3.75l-4.24-4.24m4.24 4.24l3.75-3.75m-3.75 3.75L1.5 15.17m14.48-4.48l-4.24-4.24m4.24 4.24l-4.24-4.24m4.24 4.24l5.83 5.83m-5.83-5.83l-5.83-5.83m5.83 5.83l-4.24 4.24" /></svg>
                Tools
            </a>
            <a href="#" class="menu-link" data-page="settings">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M10.343 3.94c.09-.542.56-1.002 1.13-1.19a8.25 8.25 0 011.06 0c.57.188 1.04.648 1.13 1.19l.09 1.08c.394.062.784.152 1.15.27l1.04-.32c.51-.158 1.07-.03 1.48.38a7.5 7.5 0 010 10.61c-.41.41-1.01.538-1.48.38l-1.04-.32a9.025 9.025 0 01-1.15.27l-.09 1.08c-.09.542-.56 1.002-1.13 1.19a8.25 8.25 0 01-1.06 0c-.57-.188-1.04-.648-1.13-1.19l-.09-1.08a9.025 9.025 0 01-1.15-.27l-1.04.32c-.51.158-1.07.03-1.48-.38a7.5 7.5 0 010-10.61c.41-.41 1.01.538 1.48.38l1.04.32c.366-.118.756-.208 1.15-.27l.09-1.08z" /><path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" /></svg>
                Settings
            </a>
            <!-- Bug report link now opens in a new tab -->
            <a href="https://forms.gle/Ki9Tr74K7te8cSxu8" target="_blank" class="menu-link" id="bug-report-link">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M13.05 4.29a1.5 1.5 0 01.44 1.06v.29c0 .32-.12.62-.32.85l-.33.39a1.5 1.5 0 01-2.12 0l-.33-.39a1.5 1.5 0 01-.32-.85v-.29c0-.42.17-.82.44-1.06A6.73 6.73 0 0112 3a6.73 6.73 0 011.05 1.29zm0 0a6.73 6.73 0 00-2.1 0m2.1 0a6.73 6.73 0 011.05 4.4v.22c0 .33-.13.64-.35.87l-.33.39a1.5 1.5 0 01-2.12 0l-.33-.39a1.5 1.5 0 01-.35-.87v-.22c0-1.6.48-3.1 1.3-4.4zm0 0a6.73 6.73 0 00-2.1 0m2.1 0a6.73 6.73 0 011.05 4.4v.22c0 .33-.13.64-.35.87l-.33.39a1.5 1.5 0 01-2.12 0l-.33-.39a1.5 1.5 0 01-.35-.87v-.22c0-1.6.48-3.1 1.3-4.4zM12 9.75A2.25 2.25 0 0114.25 12a2.25 2.25 0 01-2.25 2.25A2.25 2.25 0 019.75 12a2.25 2.25 0 012.25-2.25z" /><path stroke-linecap="round" stroke-linejoin="round" d="M18.364 18.364A9 9 0 005.636 5.636m12.728 12.728A9 9 0 015.636 5.636m12.728 12.728L5.636 5.636" /></svg>
                Report a Bug
            </a>
        </div>
    </div>

    <!-- Main App Wrapper -->
    <div id="app-wrapper">
        <!-- Header -->
        <header>
            <button id="menu-btn" title="Open Menu">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.5">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5" />
                </svg>
            </button>
            
            <!-- NEW SIGN -->
            <div id="snip3r-sign" title="Click me!">
                <div class="flip-card-inner">
                    <div class="flip-card-front">
                        Made by Snip3r
                    </div>
                    <div class="flip-card-back">
                        (Michael Roman)
                    </div>
                </div>
            </div>
            
            <!-- Visitor Counter -->
            <div id="visitor-counter-container">
                <a href='http://www.freevisitorcounters.com'></a> <script type='text/javascript' src='https://www.freevisitorcounters.com/auth.php?id=87733bec59a38d0f75b3e5e364af65534e046daf'></script>
                <script type="text/javascript" src="https://freevisitorcounters.com/en/home/counter/1436209/t/5"></script>
                <div id="visitor-counter-blocker"></div> <!-- INVISIBLE OVERLAY -->
            </div>

            <svg class="logo-top-right" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" stroke-width="4">
                <defs>
                    <filter id="neon-glow" x="-50%" y="-50%" width="200%" height="200%">
                        <feGaussianBlur stdDeviation="3.5" result="coloredBlur"/>
                        <feMerge>
                            <feMergeNode in="coloredBlur"/>
                            <feMergeNode in="SourceGraphic"/>
                        </feMerge>
                    </filter>
                </defs>
                <g filter="url(#neon-glow)" stroke="#00ffff">
                    <path d="M50 2 L61.2 35.5 L97.5 35.5 L68.1 56.5 L79.4 90 L50 69 L20.6 90 L31.9 56.5 L2.5 35.5 L38.8 35.5 Z" stroke="white" stroke-width="2"/>
                    <path d="M50 2 L61.2 35.5 L97.5 35.5 L68.1 56.5 L79.4 90 L50 69 L20.6 90 L31.9 56.5 L2.5 35.5 L38.8 35.5 Z"/>
                </g>
            </svg>
        </header>

        <!-- Offline Indicator Banner -->
        <div id="offline-indicator">
            You are currently offline.
        </div>
        
        <!-- Page Container -->
        <main>
            <!-- Games Page -->
            <div id="games-page" class="page active">
                <div id="game-grid" class="card-grid">
                    <!-- Games will be injected here by JS -->
                </div>
            </div>

            <!-- Offline Games Page -->
            <div id="offline-games-page" class="page">
                <!-- Content will be inside a setting-section style container -->
                <div id="offline-game-grid" class="card-grid">
                    <!-- Offline games will be injected here by JS -->
                </div>
            </div>

            <!-- Tools Page (Grid) -->
            <div id="tools-page" class="page">
                <div id="tools-grid" class="card-grid">
                    <!-- Tool cards will be injected here by JS -->
                </div>
            </div>

            <!-- Settings Page -->
            <div id="settings-page" class="page">
                <div class="setting-section" style="max-width: 700px;">
                    <h2 class="setting-title">Appearance</h2>
                    <div class="setting-item">
                        <div class="setting-item-text">
                            <h3>Starry Background</h3>
                            <p>Toggle the animated star background.</p>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="star-toggle" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                </div>
            </div>

            <!-- Individual Tool Pages -->
            <!-- Image Rounder -->
            <div id="tool-image-rounder" class="page">
                <div class="setting-section">
                    <h2 class="setting-title">Image Rounder</h2>
                    <button class="tool-btn" id="upload-image-btn">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" style="width:1.25rem; height:1.25rem; display: inline-block; margin-right: 0.5rem; vertical-align: text-bottom;">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M3 16.5v2.25A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V16.5m-13.5-9L12 3m0 0l4.5 4.5M12 3v13.5" />
                        </svg>
                        Upload Image
                    </button>
                    <input type="file" id="image-upload-input" class="hidden" accept="image/*">
                    
                    <div id="image-preview-container">
                        <span>No image uploaded</span>
                    </div>

                    <div class="slider-container">
                        <label for="border-radius-slider" class="block mb-2 text-sm font-medium text-gray-300">Border Radius: <span id="border-radius-value">25</span>%</label>
                        <input id="border-radius-slider" type="range" min="0" max="50" value="25" class="w-full">
                    </div>
                    
                    <div class="checkbox-container">
                        <input id="transparent-bg-toggle" type="checkbox" checked class="w-4 h-4 text-cyan-500 bg-gray-700 border-gray-600 rounded focus:ring-cyan-600 ring-offset-gray-800 focus:ring-2">
                        <label for="transparent-bg-toggle" class="ml-2 text-sm font-medium text-gray-300">Transparent Background</label>
                        <input type="color" id="bg-color-picker" value="#000000" class="ml-auto w-10 h-8 p-0 border-0 rounded" style="display: none; cursor: pointer;">
                    </div>

                    <button class="tool-btn" id="download-image-btn" disabled>
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" style="width:1.25rem; height:1.25rem; display: inline-block; margin-right: 0.5rem; vertical-align: text-bottom;">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M3 16.5v2.25A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V16.5M16.5 12L12 16.5m0 0L7.5 12m4.5 4.5V3" />
                        </svg>
                        Download Image
                    </button>
                    <canvas id="image-canvas" class="hidden"></canvas>
                </div>
            </div>

            <!-- Password Generator -->
            <div id="tool-password-generator" class="page">
                <div class="setting-section">
                    <h2 class="setting-title">Password Generator</h2>
                    
                    <div id="password-output-container">
                        <div id="password-output">...</div>
                        <button id="password-copy-btn" title="Copy to Clipboard">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" style="width: 24px; height: 24px; color: #fff;">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M16.5 8.25V6a2.25 2.25 0 00-2.25-2.25H6A2.25 2.25 0 003.75 6v8.25A2.25 2.25 0 006 16.5h2.25m8.25-8.25H18a2.25 2.25 0 012.25 2.25v8.25A2.25 2.25 0 0118 21H9.75A2.25 2.25 0 017.5 18.75v-2.25m0 0a3 3 0 003 3h.001M7.5 18.75a3 3 0 01-3-3V6.75a3 3 0 013-3h.001M16.5 8.25a3 3 0 00-3-3h-.001" />
                            </svg>
                        </button>
                    </div>

                    <div class="slider-container">
                        <label for="password-length-slider" class="block mb-2 text-sm font-medium text-gray-300">Password Length: <span id="password-length-value">16</span></label>
                        <input id="password-length-slider" type="range" min="8" max="32" value="16" class="w-full">
                    </div>

                    <div class="password-options">
                        <div class="password-option">
                            <label for="pw-uppercase">Uppercase (A-Z)</label>
                            <label class="toggle-switch">
                                <input type="checkbox" id="pw-uppercase" checked>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        <div class="password-option">
                            <label for="pw-lowercase">Lowercase (a-z)</label>
                            <label class="toggle-switch">
                                <input type="checkbox" id="pw-lowercase" checked>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        <div class="password-option">
                            <label for="pw-numbers">Numbers (0-9)</label>
                            <label class="toggle-switch">
                                <input type="checkbox" id="pw-numbers" checked>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        <div class="password-option">
                            <label for="pw-symbols">Symbols (!@#)</label>
                            <label class="toggle-switch">
                                <input type="checkbox" id="pw-symbols" checked>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>

                    <button class="tool-btn" id="generate-password-btn">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" style="width:1.25rem; height:1.25rem; display: inline-block; margin-right: 0.5rem; vertical-align: text-bottom;">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0l3.181 3.183a8.25 8.25 0 0011.667 0l3.181-3.183m-4.991-4.992h4.992v.001M2.985 4.356v4.992m0 0h4.992m-4.993 0l3.181-3.183a8.25 8.25 0 0111.667 0l3.181 3.183" />
                        </svg>
                        Generate New Password
                    </button>
                </div>
            </div>
            
            <!-- Unit Converter -->
            <div id="tool-unit-converter" class="page">
                <div class="setting-section">
                    <h2 class="setting-title">Unit Converter</h2>
                    <div class="converter-grid">
                        <!-- Temperature -->
                        <div class="converter-group">
                            <h3>Temperature</h3>
                            <div class="converter-row">
                                <input type="number" class="converter-input" id="celsius-input" placeholder="Celsius">
                                <span class="text-gray-400">°C</span>
                            </div>
                            <div class="converter-row">
                                <input type="number" class="converter-input" id="fahrenheit-input" placeholder="Fahrenheit">
                                <span class="text-gray-400">°F</span>
                            </div>
                        </div>
                        <!-- Weight -->
                        <div class="converter-group">
                            <h3>Weight</h3>
                            <div class="converter-row">
                                <input type="number" class="converter-input" id="kg-input" placeholder="Kilograms">
                                <span class="text-gray-400">kg</span>
                            </div>
                            <div class="converter-row">
                                <input type="number" class="converter-input" id="lbs-input" placeholder="Pounds">
                                <span class="text-gray-400">lb</span>
                            </div>
                        </div>
                        <!-- Length -->
                        <div class="converter-group">
                            <h3>Length</h3>
                            <div class="converter-row">
                                <input type="number" class="converter-input" id="meters-input" placeholder="Meters">
                                <span class="text-gray-400">m</span>
                            </div>
                            <div class="converter-row">
                                <input type="number" class="converter-input" id="feet-input" placeholder="Feet">
                                <span class="text-gray-400">ft</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </main>
    </div>

    <!-- Game View Page -->
    <div id="game-view" class="page">
        <!-- MOVED THE IFRAME WRAPPER TO BE *BEFORE* THE CONTROLS -->
        <div id="game-iframe-wrapper">
            <iframe id="game-iframe" src="" allowfullscreen></iframe>
            <!-- This toast is for the "You have no internet" message -->
            <div id="offline-game-toast" class="toast-message" style="display: none;">
                You have no internet
            </div>
        </div>
        
        <!-- MOVED THE CONTROLS TO BE *AFTER* THE IFRAME WRAPPER -->
        <div id="game-controls">
            <button class="back-btn" title="Go Back">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="3" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 19.5L8.25 12l7.5-7.5" />
                </svg>
                Back
            </button>
            <span id="game-title">Game Title</span>
            <div style="display: flex; gap: 0.5rem;">
                <button class="game-control-btn" id="mute-btn" title="Mute">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M19.114 5.636a9 9 0 010 12.728M16.463 8.288a5.25 5.25 0 010 7.424M6.75 8.25l4.72-4.72a.75.75 0 011.28.53v15.88a.75.75 0 01-1.28.53l-4.72-4.72H4.51c-.88 0-1.704-.507-1.938-1.354A9.01 9.01 0 012.25 12c0-.83.112-1.633.322-2.396C2.806 8.756 3.63 8.25 4.51 8.25H6.75z" />
                    </svg>
                </button>
                <button class="game-control-btn" id="refresh-btn" title="Refresh">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0l3.181 3.183a8.25 8.25 0 0011.667 0l3.181-3.183m-4.991-4.992h4.992v.001M2.985 4.356v4.992m0 0h4.992m-4.993 0l3.181-3.183a8.25 8.25 0 0111.667 0l3.181 3.183" />
                    </svg>
                </button>
                <button class="game-control-btn" id="fullscreen-btn" title="Fullscreen">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 3.75v4.5m0-4.5h4.5m-4.5 0L9 9M3.75 20.25v-4.5m0 4.5h4.5m-4.5 0L9 15M20.25 3.75v4.5m0-4.5h-4.5m4.5 0L15 9M20.25 20.25v-4.5m0 4.5h-4.5m4.5 0L15 15" />
                    </svg>
                </button>
            </div>
        </div>
    </div>

    <!-- Custom Context Menu -->
    <div id="custom-context-menu">
        <div class="context-menu-item" id="context-refresh">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0l3.181 3.183a8.25 8.25 0 0011.667 0l3.181-3.183m-4.991-4.992h4.992v.001M2.985 4.356v4.992m0 0h4.992m-4.993 0l3.181-3.183a8.25 8.25 0 0111.667 0l3.181 3.183" /></svg>
            <span>Refresh</span>
        </div>
        <div class="context-menu-item" id="context-home">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M2.25 12l8.954-8.955c.44-.439 1.152-.439 1.591 0L21.75 12M4.5 9.75v10.125c0 .621.504 1.125 1.125 1.125H9.75v-4.875c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125V21h4.125c.621 0 1.125-.504 1.125-1.125V9.75M8.25 21h8.25" /></svg>
            <span>Go Home</span>
        </div>
    </div>


    <script>
        // --- Data ---
        const gamesList = [
            { id: '1v1lol', name: '1v1.lol', link: 'https://securly.com.mji.ro/gamefile/1v1.html', icon: 'https://img.utdstc.com/icon/983/22a/98322a3b2be892eed31589906ffd949b68bcccc9a21ba562987965b5ec6bc6de:200' },
            { id: 'subway-surfers', name: 'Subway Surfers', link: 'https://securly.com.mji.ro/games/subway-surfers/index.html', icon: 'https://play-lh.googleusercontent.com/ScN4CEEgrYh-Bs-HYOIwBmw6zNpQs1ujW_ywRVHALWQaO2P5RuxKNXWzwRz7H9Wz3NTOTj7AIreVEDKrDz4E' },
            { id: 'smash-karts', name: 'Smash Karts', link: 'https://securly.com.mji.ro/games/smashkarts/index.html', icon: 'https://play-lh.googleusercontent.com/cM1CXOuBIy0kjGfoCTOKNa812iuVX6X2DDop8xNH4mNyjuM-oj3wVqZ7wiAOizq_TA=w240-h480-rw' },
            { id: 'ragdoll-archers', name: 'Ragdoll Archers', link: 'https://securly.com.mji.ro/games/ragdoll-archers/index.html', icon: 'https://play-lh.googleusercontent.com/XMiWEMPbuq13oVcwYQ6ySLtZnBf7WpJ3rb7v-TM4MdFOvWfo1Z2hzSEAApRXzEcshjY', offline: true },
            { id: 'bitlife', name: 'Bitlife', link: 'https://securly.com.mji.ro/games/bitlife/index.html', icon: 'https://play-lh.googleusercontent.com/fUM-UyywXxjC8soxAZdIlxJrlRRXmql8wkE426SHzft4lJycSKVd2jCYQQX1BEG9Xw' },
            { id: 'bts', name: 'Bad Time Sim', link: 'https://securly.com.mji.ro/games/bts/index.html', icon: 'https://play-lh.googleusercontent.com/T08jAj6GRGQGPOw41mQrvM_bz0ZFbqtZVL8YMbLoAy-Qu6zmLwfV7BNrPCPpUX-ZWQ' },
            { id: 'retro-bowl', name: 'Retro Bowl', link: 'https://securly.com.mji.ro/games/retro-bowl/index.html', icon: 'https://upload.wikimedia.org/wikipedia/en/b/bf/Retro_Bowl_cover.png' },
            { id: 'retro-bowl-college', name: 'Retro Bowl College', link: 'https://securly.com.mji.ro/games/rbcollege/index.html', icon: 'https://img.poki-cdn.com/cdn-cgi/image/q=78,scq=50,width=314,height=314,fit=cover,f=auto/d98547374c4129bf441b754d495e41aa/retro-bowl-college.png' },
            { id: 'time-shooter-3', name: 'Time Shooter 3', link: 'https://securly.com.mji.ro/games/timeshoot3/index.html', icon: 'https://raw.githubusercontent.com/snip3rxxgames/mp3-files-for-html/refs/heads/main/57bb8c7588843fe4c15abe2e9d43e7a3.jpg' },
            { id: 'solar-smash', name: 'Solar Smash', link: 'https.com.mji.ro/gamefile/solar.html', icon: 'https://play-lh.googleusercontent.com/9oKsgghjeohO1ztpmG6SrIMAVLn8sAhwsRGKHuOaqfMghYWiFHJ1osjwf_fAaMQZA5Y' },
            { id: 'snow-rider', name: 'Snow Rider', link: 'https://securly.com.mji.ro/games/snowrider3D-main/index.html', icon: 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTy4pT2IOPFKjPSpbVyKRi8dgk6AIVS1-iJWg&s', offline: true },
        ];
        
        const toolsList = [
            { 
                id: 'tool-image-rounder', 
                name: 'Image Rounder', 
                icon: `https://raw.githubusercontent.com/snip3rxxgames/mp3-files-for-html/refs/heads/main/Screenshot%202025-11-14%2009.03.53.png`
            },
            { 
                id: 'tool-password-generator', 
                name: 'Password Generator', 
                icon: `https://raw.githubusercontent.com/snip3rxxgames/mp3-files-for-html/refs/heads/main/Screenshot%202025-11-14%2009.07.48.png`
            },
            { 
                id: 'tool-unit-converter', 
                name: 'Unit Converter', 
                icon: `https://raw.githubusercontent.com/snip3rxxgames/mp3-files-for-html/refs/heads/main/Screenshot%202025-11-14%2009.08.30.png`
            },
        ];
        
        // --- State ---
        let currentStars = [];
        let isStarrySkyActive = true;
        let isOnline = navigator.onLine;
        let wasOffline = !navigator.onLine; // Track if we were *previously* offline
        let currentNotification = null;

        // --- DOM Elements ---
        // (We will assign these in DOMContentLoaded to be safe)
        let starCanvas, starCtx, menuBtn, menuOverlay, sideMenu, appWrapper;
        let allPages, gameViewPage, gameIframeWrapper, gameIframe, gameTitle;
        let backBtn, muteBtn, refreshBtn, fullscreenBtn, starToggle, offlineIndicator;
        let gameGrid, toolsGrid, offlineGameGrid, snip3rSign;
        
        // --- Starry Sky ---
        // (Classes and functions for the background)
        class Star {
            constructor() {
                this.x = Math.random() * starCanvas.width;
                this.y = Math.random() * starCanvas.height;
                this.size = Math.random() * 2 + 0.5; // Random size
                this.speed = Math.random() * 1.5 + 0.5; // Random speed
            }
            
            // Removed getScreenX and getScreenY

            update() {
                this.y += this.speed;
                if (this.y > starCanvas.height) {
                    this.y = 0; // Reset to top
                    this.x = Math.random() * starCanvas.width;
                    this.speed = Math.random() * 1.5 + 0.5;
                    this.size = Math.random() * 2 + 0.5;
                }
            }

            draw() {
                // Removed screenX/Y logic, just draw at x/y
                starCtx.beginPath();
                starCtx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                starCtx.fillStyle = 'rgba(255, 255, 255, 0.7)';
                starCtx.fill();
            }
        }
        
        function initStars() {
            if (!starCanvas) return;
            starCanvas.width = window.innerWidth;
            starCanvas.height = window.innerHeight;
            currentStars = [];
            for (let i = 0; i < 800; i++) {
                currentStars.push(new Star());
            }
        }

        function animateStars() {
            if (!isStarrySkyActive || !starCtx) return;
            
            starCtx.fillStyle = 'black';
            starCtx.fillRect(0, 0, starCanvas.width, starCanvas.height);
            
            // Removed save/restore
            currentStars.forEach(star => {
                star.update();
                star.draw();
            });
            
            requestAnimationFrame(animateStars);
        }

        function toggleStars(isActive) {
            isStarrySkyActive = isActive;
            if (isStarrySkyActive) {
                starCanvas.style.display = 'block';
                initStars(); // Re-init to avoid weirdness
                animateStars(); // Restart animation
            } else {
                starCanvas.style.display = 'none';
                if (starCtx) {
                    starCtx.fillStyle = 'black';
                    starCtx.fillRect(0, 0, starCanvas.width, starCanvas.height);
                }
            }
        }

        // --- Navigation ---
        function toggleMenu() {
            sideMenu.classList.toggle('active');
            menuOverlay.classList.toggle('active');
        }

        function closeMenu() {
            sideMenu.classList.remove('active');
            menuOverlay.classList.remove('active');
        }

        function showPage(pageId) {
            // Check for special "tool" page
            if (pageId.startsWith('tool-')) {
                // Hide all main pages
                allPages.forEach(p => p.classList.remove('active'));
                // Show the specific tool page
                const toolPage = document.getElementById(pageId);
                if (toolPage) {
                    toolPage.classList.add('active');
                }
            } else {
                // Standard page navigation
                allPages.forEach(p => {
                    // Match 'games' to 'games-page', 'offline-games' to 'offline-games-page'
                    if (p.id === `${pageId}-page` || p.id === pageId) {
                        p.classList.add('active');
                    } else {
                        p.classList.remove('active');
                    }
                });
            }
            
            // Special check for 'games' page to hide 'game-view'
            if (pageId === 'games' || pageId === 'games-page') {
                gameViewPage.classList.remove('active');
                gameIframe.src = 'about:blank';
            }
            
            // Scroll to top of new page
            document.querySelector('main').scrollTop = 0;
            
            closeMenu();
        }

        // --- Game Loading ---
        function populateGameGrid() {
            if (!gameGrid) return;
            gameGrid.innerHTML = '';
            gamesList.forEach(game => {
                const card = document.createElement('a');
                card.href = '#';
                card.className = 'card game-card';
                card.dataset.gameId = game.id;
                card.innerHTML = `
                    <img src="${game.icon}" alt="${game.name}" class="card-icon" onerror="this.src='https://placehold.co/200x200/000000/333333?text=Error'">
                    <span>${game.name}</span>
                `;
                gameGrid.appendChild(card);
            });
            updateOfflineGameStyles();
        }
        
        function populateOfflineGameGrid() {
            if (!offlineGameGrid) return;
            offlineGameGrid.innerHTML = '';
            
            const offlineGames = gamesList.filter(g => g.offline);
            
            offlineGames.forEach(game => {
                const isDownloaded = localStorage.getItem(`offline_game_${game.id}`) === 'true';
                const card = document.createElement('a');
                card.href = '#';
                card.className = 'card offline-game-card';
                if (!isDownloaded) {
                    card.classList.add('offline-not-downloaded');
                }
                card.dataset.gameId = game.id;
                card.innerHTML = `
                    <div class="card-loader">
                        <div class="progress-bar-container">
                            <div class="progress-bar" style="width: 0%;"></div>
                        </div>
                        <div class="progress-text">DOWNLOADING 0%</div>
                    </div>
                    <img src="${game.icon}" alt="${game.name}" class="card-icon" onerror="this.src='https://placehold.co/200x200/000000/333333?text=Error'">
                    <span>${game.name}</span>
                `;
                offlineGameGrid.appendChild(card);
            });
        }

        function populateToolsGrid() {
            if (!toolsGrid) return;
            toolsGrid.innerHTML = '';
            toolsList.forEach(tool => {
                const card = document.createElement('a');
                card.href = '#';
                card.className = 'card tool-card';
                card.dataset.page = tool.id; // Link to the tool's page
                card.innerHTML = `
                    <img src="${tool.icon}" alt="${tool.name}" class="card-icon" onerror="this.src='https://placehold.co/200x200/000000/333333?text=Error'">
                    <span>${tool.name}</span>
                `;
                toolsGrid.appendChild(card);
            });
        }
        
        function showOfflineGameToast() {
            const toast = document.getElementById('offline-game-toast');
            toast.style.display = 'block';
            setTimeout(() => {
                toast.style.display = 'none';
            }, 2000);
        }

        function loadGame(gameId) {
            if (!isOnline) {
                showOfflineGameToast();
                return;
            }
            
            const game = gamesList.find(g => g.id === gameId);
            if (!game) return;

            gameTitle.textContent = game.name;
            gameIframe.src = game.link;
            gameViewPage.classList.add('active');
            
            // Hide main content
            allPages.forEach(p => p.classList.remove('active'));
        }

        function goBackFromGame() {
            // If in fullscreen, exit fullscreen first
            if (document.fullscreenElement) {
                document.exitFullscreen().catch(err => console.error(err));
            }
            
            gameIframe.src = 'about:blank';
            gameViewPage.classList.remove('active');
            showPage('games'); // Go back to the games page
        }

        // --- Game Controls ---
        function setupGameControls() {
            backBtn.addEventListener('click', goBackFromGame);

            refreshBtn.addEventListener('click', () => {
                gameIframe.src = gameIframe.src;
            });

            muteBtn.addEventListener('click', () => {
                const isMuted = gameIframe.hasAttribute('muted');
                if (isMuted) {
                    gameIframe.removeAttribute('muted');
                    muteBtn.title = 'Mute';
                    muteBtn.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M19.114 5.636a9 9 0 010 12.728M16.463 8.288a5.25 5.25 0 010 7.424M6.75 8.25l4.72-4.72a.75.75 0 011.28.53v15.88a.75.75 0 01-1.28.53l-4.72-4.72H4.51c-.88 0-1.704-.507-1.938-1.354A9.01 9.01 0 012.25 12c0-.83.112-1.633.322-2.396C2.806 8.756 3.63 8.25 4.51 8.25H6.75z" /></svg>`;
                } else {
                    gameIframe.setAttribute('muted', 'true');
                    muteBtn.title = 'Unmute';
                    muteBtn.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M17.25 9.75L19.5 12m0 0l2.25 2.25M19.5 12l2.25-2.25M19.5 12l-2.25 2.25m-10.5-6l4.72-4.72a.75.75 0 011.28.53v15.88a.75.75 0 01-1.28.53l-4.72-4.72H4.51c-.88 0-1.704-.507-1.938-1.354A9.01 9.01 0 012.25 12c0-.83.112-1.633.322-2.396C2.806 8.756 3.63 8.25 4.51 8.25H6.75z" /></svg>`;
                }
            });

            fullscreenBtn.addEventListener('click', () => {
                if (document.fullscreenElement) {
                    document.exitFullscreen();
                } else {
                    // Only make the iframe wrapper fullscreen
                    gameIframeWrapper.requestFullscreen().catch(err => {
                        console.error(`Error attempting to enable fullscreen: ${err.message} (${err.name})`);
                    });
                }
            });
        }

        // --- Offline Handling ---
        function updateOfflineStatus() {
            isOnline = navigator.onLine;
            
            if (isOnline) {
                if (wasOffline) { // Only show "back online" if we were offline
                    offlineIndicator.textContent = 'You are back online!';
                    offlineIndicator.classList.add('online');
                    offlineIndicator.classList.add('active');
                    
                    setTimeout(() => {
                        offlineIndicator.classList.remove('active');
                    }, 3000);
                }
                wasOffline = false; // Reset the flag
            } else {
                offlineIndicator.textContent = 'You are currently offline.';
                offlineIndicator.classList.remove('online');
                offlineIndicator.classList.add('active');
                wasOffline = true; // Set the flag
            }
            
            updateOfflineGameStyles();
        }

        function updateOfflineGameStyles() {
            const cards = document.querySelectorAll('.game-card');
            cards.forEach(card => {
                if (!isOnline) {
                    card.classList.add('offline-disabled');
                } else {
                    card.classList.remove('offline-disabled');
                }
            });
        }
        
        // --- Offline Game "Downloader" ---
        function showOfflineDownloadNotification() {
            // Check if user has already been prompted
            if (localStorage.getItem('downloadPromptSeen') === 'true') {
                return;
            }
            
            // Check if ALL offline games are already downloaded
            const allOfflineGames = gamesList.filter(g => g.offline);
            const allDownloaded = allOfflineGames.every(game => localStorage.getItem(`offline_game_${game.id}`) === 'true');

            if (isOnline && !allDownloaded) {
                // This callback will run when "X" or "Download" is clicked
                const setPromptSeenFlag = () => {
                    localStorage.setItem('downloadPromptSeen', 'true');
                };
                
                showNotification(
                    "Would you like to download the offline games? This way, you can play some games without internet connection.",
                    "Download",
                    startOfflineGameDownload, // This runs on "Download" click
                    setPromptSeenFlag       // This runs on "Download" OR "X" click
                );
            }
        }
        
        function startOfflineGameDownload() {
            const allOfflineGames = gamesList.filter(g => g.offline);
            
            allOfflineGames.forEach(game => {
                const isDownloaded = localStorage.getItem(`offline_game_${game.id}`) === 'true';
                if (!isDownloaded) {
                    const card = document.querySelector(`.offline-game-card[data-game-id="${game.id}"]`);
                    if (card) {
                        simulateDownload(card, game.id);
                    }
                }
            });
        }
        
        function simulateDownload(card, gameId) {
            card.classList.add('loading');
            
            const progressBar = card.querySelector('.progress-bar');
            const progressText = card.querySelector('.progress-text');
            
            let progress = 0;
            const randomDuration = (Math.random() * 60 + 30) * 1000; // 30s to 90s
            const intervalTime = 100; // Update every 100ms
            const progressIncrement = (intervalTime / randomDuration) * 100;

            const interval = setInterval(() => {
                progress += progressIncrement;
                if (progress >= 100) {
                    progress = 100;
                    clearInterval(interval);
                    
                    card.classList.remove('loading');
                    card.classList.remove('offline-not-downloaded');
                    localStorage.setItem(`offline_game_${gameId}`, 'true');
                    
                    // Reset loader for next time
                    progressBar.style.width = '0%';
                    progressText.textContent = 'DOWNLOADING 0%';
                }
                
                progressBar.style.width = `${progress}%`;
                progressText.textContent = `DOWNLOADING ${Math.floor(progress)}%`;
                
            }, intervalTime);
        }

        // --- Notification System ---
        function showNotification(text, buttonText = null, buttonCallback = null, closeCallback = null) {
            const banner = document.getElementById('notification-banner');
            const textEl = document.getElementById('notification-text');
            const buttonEl = document.getElementById('notification-button');
            const closeBtn = document.getElementById('notification-close');

            textEl.textContent = text;

            if (buttonText && buttonCallback) {
                buttonEl.textContent = buttonText;
                buttonEl.classList.remove('hidden');
                
                // Remove old listener if exists
                if (currentNotification && currentNotification.buttonCallback) {
                    buttonEl.removeEventListener('click', currentNotification.buttonCallback);
                }
                
                // Add new listener
                buttonEl.addEventListener('click', buttonCallbackWrapper);
                
                currentNotification = {
                    buttonCallback: buttonCallbackWrapper
                };
                
                function buttonCallbackWrapper() {
                    if (buttonCallback) buttonCallback();
                    hideNotification();
                    if (closeCallback) closeCallback(); // Run the close callback
                    buttonEl.removeEventListener('click', buttonCallbackWrapper); // Clean up
                }

            } else {
                buttonEl.classList.add('hidden');
                currentNotification = null;
            }

            // Always add close listener
            closeBtn.onclick = () => {
                hideNotification();
                if (closeCallback) closeCallback(); // Run the close callback
            };

            // Show the banner
            banner.classList.add('show');
            appWrapper.style.paddingTop = '90px';
        }

        function hideNotification() {
            const banner = document.getElementById('notification-banner');
            const canvas = document.getElementById('notification-fade-canvas');
            const ctx = canvas.getContext('2d');
            
            banner.classList.remove('show');
            appWrapper.style.paddingTop = '0';
            
            // --- Pixel Fade Effect ---
            canvas.width = banner.clientWidth;
            canvas.height = banner.clientHeight;
            canvas.style.display = 'block';

            // 1. Draw the banner content onto the canvas
            ctx.fillStyle = '#FFA500'; // Banner background
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            ctx.fillStyle = '#000'; // Text color
            ctx.font = '600 1rem Inter';
            ctx.textBaseline = 'middle';
            
            const text = document.getElementById('notification-text').textContent;
            ctx.fillText(text, 24, canvas.height / 2); // 1.5rem padding
            
            const button = document.getElementById('notification-button');
            if (!button.classList.contains('hidden')) {
                const btnRect = button.getBoundingClientRect();
                const bannerRect = banner.getBoundingClientRect();
                ctx.fillStyle = '#FF8C00'; // Button color
                ctx.fillRect(btnRect.left - bannerRect.left, (canvas.height - btnRect.height) / 2, btnRect.width, btnRect.height);
                ctx.fillStyle = '#FFF'; // Button text
                ctx.font = '700 1rem Inter';
                ctx.fillText(button.textContent, btnRect.left - bannerRect.left + 16, canvas.height / 2);
            }
            
            // 2. Get pixel data
            const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
            const pixels = imageData.data;
            const numPixels = imageData.width * imageData.height;
            
            // Create an array of pixel indices
            let pixelIndices = Array.from({ length: numPixels }, (_, i) => i);
            
            // Shuffle the array
            for (let i = pixelIndices.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [pixelIndices[i], pixelIndices[j]] = [pixelIndices[j], pixelIndices[i]];
            }

            // 3. Animate fading
            const duration = 3000; // 3 seconds
            const pixelsPerFrame = Math.ceil(numPixels / (duration / 16.67)); // ~60fps
            let currentPixel = 0;

            function fadeFrame() {
                if (currentPixel >= numPixels) {
                    canvas.style.display = 'none'; // Hide canvas when done
                    return;
                }
                
                for (let i = 0; i < pixelsPerFrame && currentPixel < numPixels; i++) {
                    const index = pixelIndices[currentPixel];
                    pixels[index * 4 + 3] = 0; // Set alpha to 0
                    currentPixel++;
                }
                
                ctx.putImageData(imageData, 0, 0);
                requestAnimationFrame(fadeFrame);
            }
            
            fadeFrame();
        }

        // --- Custom Context Menu ---
        function setupContextMenu() {
            const menu = document.getElementById('custom-context-menu');
            
            document.addEventListener('contextmenu', (e) => {
                e.preventDefault();
                
                // Don't show menu over the game iframe
                if (e.target.id === 'game-iframe') {
                    return;
                }
                
                menu.style.display = 'block';
                
                // Position menu
                const { clientX, clientY } = e;
                const { innerWidth, innerHeight } = window;
                const menuWidth = menu.offsetWidth;
                const menuHeight = menu.offsetHeight;
                
                let x = clientX;
                let y = clientY;
                
                if (clientX + menuWidth > innerWidth) {
                    x = innerWidth - menuWidth - 5;
                }
                if (clientY + menuHeight > innerHeight) {
                    y = innerHeight - menuHeight - 5;
                }
                
                menu.style.left = `${x}px`;
                menu.style.top = `${y}px`;
            });

            document.addEventListener('click', () => {
                menu.style.display = 'none';
            });
            
            document.getElementById('context-refresh').addEventListener('click', () => {
                location.reload();
            });
            
            document.getElementById('context-home').addEventListener('click', () => {
                goBackFromGame(); // This also works to just go home
                showPage('games');
            });
        }
        
        // --- Tool: Image Rounder ---
        function setupImageRounder() {
            const uploadBtn = document.getElementById('upload-image-btn');
            const fileInput = document.getElementById('image-upload-input');
            const previewContainer = document.getElementById('image-preview-container');
            const slider = document.getElementById('border-radius-slider');
            const sliderValue = document.getElementById('border-radius-value');
            const downloadBtn = document.getElementById('download-image-btn');
            const canvas = document.getElementById('image-canvas');
            const ctx = canvas.getContext('2d');
            const transparentToggle = document.getElementById('transparent-bg-toggle');
            const bgColorPicker = document.getElementById('bg-color-picker');
            
            let originalImage = null;

            uploadBtn.addEventListener('click', () => fileInput.click());
            
            fileInput.addEventListener('change', (e) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (event) => {
                        const img = new Image();
                        img.onload = () => {
                            originalImage = img;
                            previewContainer.innerHTML = '';
                            previewContainer.appendChild(img);
                            img.id = 'image-preview';
                            downloadBtn.disabled = false;
                            updateImagePreview();
                        };
                        img.src = event.target.result;
                    };
                    reader.readAsDataURL(file);
                }
            });
            
            slider.addEventListener('input', () => {
                sliderValue.textContent = slider.value;
                updateImagePreview();
            });
            
            transparentToggle.addEventListener('change', () => {
                bgColorPicker.style.display = transparentToggle.checked ? 'none' : 'inline-block';
            });

            function updateImagePreview() {
                if (!originalImage) return;
                const previewImg = document.getElementById('image-preview');
                const radius = (slider.value / 100) * Math.min(previewImg.width, previewImg.height) * 2;
                previewImg.style.borderRadius = `${radius}px`;
            }
            
            downloadBtn.addEventListener('click', () => {
                if (!originalImage) return;

                const size = Math.max(originalImage.width, originalImage.height);
                canvas.width = size;
                canvas.height = size;
                ctx.clearRect(0, 0, size, size);

                // Calculate radius
                // slider.value is 0-50, which is a percentage of the *half* side
                const radius = (slider.value / 100) * size;
                
                if (!transparentToggle.checked) {
                    ctx.fillStyle = bgColorPicker.value;
                    ctx.fillRect(0, 0, size, size);
                }

                ctx.save();
                ctx.beginPath();
                ctx.moveTo(radius, 0);
                ctx.lineTo(size - radius, 0);
                ctx.quadraticCurveTo(size, 0, size, radius);
                ctx.lineTo(size, size - radius);
                ctx.quadraticCurveTo(size, size, size - radius, size);
                ctx.lineTo(radius, size);
                ctx.quadraticCurveTo(0, size, 0, size - radius);
                ctx.lineTo(0, radius);
                ctx.quadraticCurveTo(0, 0, radius, 0);
                ctx.closePath();
                ctx.clip();
                
                // Draw image centered
                const x = (size - originalImage.width) / 2;
                const y = (size - originalImage.height) / 2;
                ctx.drawImage(originalImage, x, y);
                
                ctx.restore();

                const link = document.createElement('a');
                link.download = 'rounded-image.png';
                link.href = canvas.toDataURL('image/png');
                link.click();
            });
        }
        
        // --- Tool: Password Generator ---
        function setupPasswordGenerator() {
            const output = document.getElementById('password-output');
            const lengthSlider = document.getElementById('password-length-slider');
            const lengthValue = document.getElementById('password-length-value');
            const upperCheck = document.getElementById('pw-uppercase');
            const lowerCheck = document.getElementById('pw-lowercase');
            const numbersCheck = document.getElementById('pw-numbers');
            const symbolsCheck = document.getElementById('pw-symbols');
            const generateBtn = document.getElementById('generate-password-btn');
            const copyBtn = document.getElementById('password-copy-btn');

            const charsets = {
                upper: 'ABCDEFGHIJKLMNOPQRSTUVWXYZ',
                lower: 'abcdefghijklmnopqrstuvwxyz',
                numbers: '0123456789',
                symbols: '!@#$%^&*()_+-=[]{}|;:,.<>?'
            };

            function generatePassword() {
                const length = lengthSlider.value;
                let charset = '';
                if (upperCheck.checked) charset += charsets.upper;
                if (lowerCheck.checked) charset += charsets.lower;
                if (numbersCheck.checked) charset += charsets.numbers;
                if (symbolsCheck.checked) charset += charsets.symbols;

                if (charset === '') {
                    output.textContent = '...';
                    return;
                }

                let password = '';
                for (let i = 0; i < length; i++) {
                    const randomIndex = Math.floor(Math.random() * charset.length);
                    password += charset[randomIndex];
                }
                output.textContent = password;
            }

            lengthSlider.addEventListener('input', () => {
                lengthValue.textContent = lengthSlider.value;
                generatePassword();
            });
            
            [upperCheck, lowerCheck, numbersCheck, symbolsCheck, generateBtn].forEach(el => {
                el.addEventListener('click', generatePassword);
            });
            
            copyBtn.addEventListener('click', () => {
                const password = output.textContent;
                if (password && password !== '...') {
                    // Use execCommand for broader compatibility in sandboxed iframes
                    const tempTextarea = document.createElement('textarea');
                    tempTextarea.value = password;
                    document.body.appendChild(tempTextarea);
                    tempTextarea.select();
                    try {
                        document.execCommand('copy');
                        copyBtn.title = 'Copied!';
                        setTimeout(() => copyBtn.title = 'Copy to Clipboard', 1500);
                    } catch (err) {
                        console.error('Failed to copy password: ', err);
                        copyBtn.title = 'Failed to copy';
                    }
                    document.body.removeChild(tempTextarea);
                }
            });

            // Initial generation
            generatePassword();
        }
        
        // --- Tool: Unit Converter ---
        function setupUnitConverter() {
            const celsius = document.getElementById('celsius-input');
            const fahrenheit = document.getElementById('fahrenheit-input');
            const kg = document.getElementById('kg-input');
            const lbs = document.getElementById('lbs-input');
            const meters = document.getElementById('meters-input');
            const feet = document.getElementById('feet-input');

            celsius.addEventListener('input', () => { 
                if (celsius.value === '') {
                    fahrenheit.value = '';
                    return;
                }
                fahrenheit.value = (celsius.value * 9/5 + 32).toFixed(2); 
            });
            fahrenheit.addEventListener('input', () => { 
                if (fahrenheit.value === '') {
                    celsius.value = '';
                    return;
                }
                celsius.value = ((fahrenheit.value - 32) * 5/9).toFixed(2); 
            });
            
            kg.addEventListener('input', () => { 
                if (kg.value === '') {
                    lbs.value = '';
                    return;
                }
                lbs.value = (kg.value * 2.20462).toFixed(2); 
            });
            lbs.addEventListener('input', () => { 
                if (lbs.value === '') {
                    kg.value = '';
                    return;
                }
                kg.value = (lbs.value / 2.20462).toFixed(2); 
            });
            
            meters.addEventListener('input', () => { 
                if (meters.value === '') {
                    feet.value = '';
                    return;
                }
                feet.value = (meters.value * 3.28084).toFixed(2); 
            });
            feet.addEventListener('input', () => { 
                if (feet.value === '') {
                    meters.value = '';
                    return;
                }
                meters.value = (feet.value / 3.28084).toFixed(2); 
            });
        }

        // --- App Initialization ---
        document.addEventListener('DOMContentLoaded', () => {
            // Find all DOM elements
            starCanvas = document.getElementById('star-canvas');
            starCtx = starCanvas ? starCanvas.getContext('2d') : null;
            menuBtn = document.getElementById('menu-btn');
            menuOverlay = document.getElementById('menu-overlay');
            sideMenu = document.getElementById('side-menu');
            appWrapper = document.getElementById('app-wrapper');
            snip3rSign = document.getElementById('snip3r-sign');
            
            gameViewPage = document.getElementById('game-view');
            gameIframeWrapper = document.getElementById('game-iframe-wrapper');
            gameIframe = document.getElementById('game-iframe');
            gameTitle = document.getElementById('game-title');
            
            backBtn = gameViewPage.querySelector('.back-btn');
            muteBtn = document.getElementById('mute-btn');
            refreshBtn = document.getElementById('refresh-btn');
            fullscreenBtn = document.getElementById('fullscreen-btn');
            
            starToggle = document.getElementById('star-toggle');
            offlineIndicator = document.getElementById('offline-indicator');
            
            gameGrid = document.getElementById('game-grid');
            toolsGrid = document.getElementById('tools-grid');
            offlineGameGrid = document.getElementById('offline-game-grid');
            
            // Collect all pages
            allPages = document.querySelectorAll('main > .page, .page[id^="tool-"]');
            
            // --- Setup ---
            // Background
            if (starCtx) {
                toggleStars(isStarrySkyActive);
            }
            
            // Sign Flipper
            snip3rSign.addEventListener('click', () => {
                if (snip3rSign.classList.contains('is-flipped')) {
                    return; // Don't re-flip if already flipped
                }
                
                snip3rSign.classList.add('is-flipped');
                
                setTimeout(() => {
                    snip3rSign.classList.remove('is-flipped');
                }, 2000); // Flip back after 2 seconds
            });
            
            // Navigation
            menuBtn.addEventListener('click', toggleMenu);
            menuOverlay.addEventListener('click', closeMenu);
            
            document.querySelectorAll('.menu-link').forEach(link => {
                // Handle internal page links
                if (link.dataset.page) {
                    link.addEventListener('click', (e) => {
                        e.preventDefault();
                        const pageId = link.dataset.page;
                        showPage(pageId);
                        
                        // Special action for offline games page
                        if (pageId === 'offline-games') {
                            showOfflineDownloadNotification();
                        }
                    });
                }
                // External links (like bug report) are handled by target="_blank"
            });
            
            // Grid Population
            populateGameGrid();
            populateOfflineGameGrid();
            populateToolsGrid();
            
            // Event Listeners for Grids
            gameGrid.addEventListener('click', (e) => {
                const card = e.target.closest('.game-card');
                if (card) {
                    e.preventDefault();
                    loadGame(card.dataset.gameId);
                }
            });
            
            toolsGrid.addEventListener('click', (e) => {
                const card = e.target.closest('.tool-card');
                if (card) {
                    e.preventDefault();
                    showPage(card.dataset.page);
                }
            });
            
            offlineGameGrid.addEventListener('click', (e) => {
                const card = e.target.closest('.offline-game-card');
                if (card) {
                    e.preventDefault();
                    // Here you would load the locally cached game
                    console.log("Attempting to load offline game:", card.dataset.gameId);
                }
            });

            // Game Controls
            setupGameControls();
            
            // Settings
            starToggle.addEventListener('change', () => {
                toggleStars(starToggle.checked);
            });
            
            // Offline/Online Status
            window.addEventListener('online', updateOfflineStatus);
            window.addEventListener('offline', updateOfflineStatus);
            updateOfflineStatus(); // Initial check
            
            // Context Menu
            setupContextMenu();
            
            // Tool Setup
            setupImageRounder();
            setupPasswordGenerator();
            setupUnitConverter();
        });

    </script>
</body>
</html>
